<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Equipment Management System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>Equipment / Component Issue & Return Management</h1>
</header>

<nav>
    <a href="index.html">Home</a>
    <a href="issue.html">Issue Equipment</a>
    <a href="return.html">Return Equipment</a>
</nav>

<section>
    <h2>Current Inventory</h2>
    <button onclick="initializeData()" style="background: #28a745; margin-right: 10px;">Initialize Equipment Data</button>
    <button onclick="loadInventory()">Refresh Inventory</button>

    <div id="inventory" class="inventory-list"></div>
</section>

<script>
function initializeData() {
    fetch("http://localhost:8080/api/equipment/initialize", {
        method: "POST"
    })
    .then(res => res.text())
    .then(data => {
        alert(data);
        loadInventory();
    })
    .catch(err => {
        alert("Error initializing data. Make sure MongoDB is running!");
    });
}

function loadInventory() {
    fetch("http://localhost:8080/api/equipment/inventory")
        .then(res => res.json())
        .then(data => {
            let html = `<table>
                <thead>
                    <tr>
                        <th>Equipment Name</th>
                        <th>Available Quantity</th>
                        <th>Total Quantity</th>
                        <th>Issued Quantity</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>`;
            
            data.forEach(item => {
                let issuedQty = item.totalQuantity - item.availableQuantity;
                let status = '';
                
                if (item.availableQuantity === 0) {
                    status = '<span style="color: #dc3545; font-weight: bold;">Out of Stock</span>';
                } else if (item.availableQuantity < item.totalQuantity * 0.3) {
                    status = '<span style="color: #ff9800; font-weight: bold;">Low Stock</span>';
                } else {
                    status = '<span style="color: #28a745; font-weight: bold;">Available</span>';
                }
                
                html += `<tr>
                    <td><strong>${item.name}</strong></td>
                    <td><span style="color: #0066cc; font-size: 18px; font-weight: bold;">${item.availableQuantity}</span></td>
                    <td>${item.totalQuantity}</td>
                    <td>${issuedQty > 0 ? '<span style="color: #ff6b6b; font-weight: bold;">' + issuedQty + '</span>' : '0'}</td>
                    <td>${status}</td>
                </tr>`;
            });
            
            html += "</tbody></table>";
            
            // Add summary cards
            let totalItems = data.reduce((sum, item) => sum + item.totalQuantity, 0);
            let availableItems = data.reduce((sum, item) => sum + item.availableQuantity, 0);
            let issuedItems = totalItems - availableItems;
            
            html = `
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>Total Equipment</h3>
                        <p class="summary-number">${totalItems}</p>
                    </div>
                    <div class="summary-card available">
                        <h3>Available</h3>
                        <p class="summary-number">${availableItems}</p>
                    </div>
                    <div class="summary-card issued">
                        <h3>Currently Issued</h3>
                        <p class="summary-number">${issuedItems}</p>
                    </div>
                </div>
            ` + html;
            
            document.getElementById("inventory").innerHTML = html;
        })
        .catch(err => {
            document.getElementById("inventory").innerHTML = 
                "<p style='color: red;'>Error loading inventory. Make sure the server and MongoDB are running!</p>";
        });
}

// Auto-refresh every 5 seconds to show real-time updates
let autoRefreshInterval;

function startAutoRefresh() {
    autoRefreshInterval = setInterval(loadInventory, 5000);
}

function stopAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }
}

// Start auto-refresh when page loads
window.onload = function() {
    loadInventory();
    startAutoRefresh();
};

// Stop auto-refresh when leaving the page
window.onbeforeunload = stopAutoRefresh;
</script>

<style>
.summary-cards {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 30px auto;
    max-width: 900px;
}

.summary-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 10px;
    flex: 1;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
}

.summary-card:hover {
    transform: translateY(-5px);
}

.summary-card.available {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.summary-card.issued {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
}

.summary-card h3 {
    margin: 0 0 10px 0;
    font-size: 16px;
    font-weight: normal;
    opacity: 0.9;
}

.summary-number {
    font-size: 36px;
    font-weight: bold;
    margin: 0;
}

.inventory-list table {
    margin-top: 20px;
}

.inventory-list tbody tr {
    transition: background 0.3s ease;
}
</style>

</body>
</html>